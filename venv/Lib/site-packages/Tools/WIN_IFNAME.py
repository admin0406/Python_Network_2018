import netifaces as ni
import winreg as wr


def get_connection_name_from_guid(iface_guids): # 查询WIN注册表,返回名字与接口唯一ID字符串的对应关系
    iface_names = ['(unknown)' for i in range(len(iface_guids))]
    reg = wr.ConnectRegistry(None, wr.HKEY_LOCAL_MACHINE)
    reg_key = wr.OpenKey(reg, r'SYSTEM\CurrentControlSet\Control\Network\{4d36e972-e325-11ce-bfc1-08002be10318}')
    for i in range(len(iface_guids)):
        try:
            reg_subkey = wr.OpenKey(reg_key, iface_guids[i] + r'\Connection')
            iface_names[i] = wr.QueryValueEx(reg_subkey, 'Name')[0]
        except FileNotFoundError:
            pass
    # for i in zip(iface_guids, iface_names):
    #     print(i)
    #('{3B759B87-F5DD-4CFB-8755-F4C77E2B7B0A}', 'Net1')
    #('{EDDEA13C-C291-11E7-9C8C-806E6F6E6963}', '(unknown)')
    return zip(iface_guids, iface_names)


def win_from_name_get_id(ifname): # 查找特定名字对应的接口唯一ID字符串
    x = ni.interfaces()
    for i in get_connection_name_from_guid(x):
        if i[1] == ifname:
            return i[0]


if __name__ == "__main__":
    print(win_from_name_get_id("Net1"))
    # {3B759B87-F5DD-4CFB-8755-F4C77E2B7B0A}